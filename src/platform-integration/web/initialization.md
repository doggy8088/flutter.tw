---
title: Customizing web app initialization
title: 自訂 Web 應用程式的初始化
description: Customize how Flutter apps are initialized on the web
description: 自訂 Flutter 應用程式在 Web 上的初始化方式
---

You can customize how a Flutter app is initialized on the web
using the `_flutter.loader` JavaScript API provided by `flutter.js`.
This API can be used to display a loading indicator in CSS,
prevent the app from loading based on a condition,
or wait until the user presses a button before showing the app.

你可以使用 `flutter.js` 提供的 `_flutter.loader` JavaScript API 
來自訂 Flutter 應用程式在 web 上的初始化方式。
該 API 可以用於在 CSS 中顯示載入指示器，
也可以根據條件阻止載入應用程式，
還可以等待使用者按下按鈕後再顯示應用程式。

The initialization process is split into the following stages:

初始化過程分為以下階段：

**Loading the entrypoint script**
<br>Fetches the `main.dart.js` script and initializes the service worker.

**載入入口指令碼**
<br>獲取 `main.dart.js` 指令碼並初始化 service worker。

**Initializing the Flutter engine**
<br>Initializes Flutter's web engine by downloading required resources 
such as assets, fonts, and CanvasKit.

**初始化 Flutter 引擎**
<br>透過下載所需資源（如靜態資源、字型和 CanvasKit）來初始化 Flutter web 引擎。

**Running the app**
<br>Prepares the DOM for your Flutter app and runs it.

**執行應用程式**
<br>為 Flutter 應用程式準備 DOM 並執行。

This page shows how to customize the behavior
at each stage of the initialization process.

本篇介紹瞭如何自訂初始化過程各個階段的行為。

## Getting started

## 入門指南

By default, the `index.html` file
generated by the `flutter create` command
contains a script tag
that calls `loadEntrypoint` from the `flutter.js` file:

預設情況下，`flutter create` 指令產生的 `index.html` 檔案
包含一個 script 標籤，
用於呼叫 `flutter.js` 檔案中的 `loadEntrypoint`：

```html
<html>
  <head>
    <!-- ... -->
    <script src="flutter.js" defer></script>
  </head>
  <body>
    <script>
      window.addEventListener('load', function (ev) {
        // Download main.dart.js
        _flutter.loader.loadEntrypoint({
          serviceWorker: {
            serviceWorkerVersion: serviceWorkerVersion,
          },
          onEntrypointLoaded: async function(engineInitializer) {
            // Initialize the Flutter engine
            let appRunner = await engineInitializer.initializeEngine();
            // Run the app
            await appRunner.runApp();
          }
        });
      });
    </script>
  </body>
</html>
```

{{site.alert.note}}

  In Flutter 2.10 or earlier,
  this script doesn't support customization.
  To upgrade your `index.html` file to the latest version,
  see [Upgrading an older project](#upgrading-an-older-project).

  在 Flutter 2.10 或更早的版本中，
  該指令碼不支援自訂。
  你需要將 `index.html` 檔案升級到最新版本，
  請查閱 [升級舊專案](#upgrading-an-older-project)。

{{site.alert.end}}

The `loadEntrypoint` function calls the `onEntrypointLoaded` callback
once the Service Worker is initialized, and the `main.dart.js` entrypoint
has been downloaded and run by the browser. Flutter also calls
`onEntrypointLoaded` on every hot restart during development.

一旦 Service Worker 初始化，且瀏覽器下載並運行了 `main.dart.js` 入口，
`loadEntrypoint` 函式就會呼叫 `onEntrypointLoaded` 回呼(Callback)。
Flutter 還會在開發過程中每次熱重載時呼叫 `onEntrypointLoaded`。

The `onEntrypointLoaded` callback receives an **engine initializer** object as
its only parameter. Use the engine initializer to set the run-time
configuration, and start the Flutter Web engine.

`onEntrypointLoaded` 回呼(Callback)接收一個 **engine initializer** 物件作為唯一引數。
使用 engine initializer 設定執行時的配置，並啟動 Flutter Web 引擎。

The `initializeEngine()` function returns a [`Promise`][js-promise]
that resolves with an **app runner** object. The app runner has a
single method, `runApp()`, that runs the Flutter app.

`initializeEngine()` 函式返回一個
包含了 **app runner** 物件的 [`Promise`][js-promise]。
app runner 只有一個 `runApp()` 方法，它用於執行 Flutter 應用程式。

[js-promise]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise

## Customizing web app initialization

## 自訂 web 應用程式的初始化

In this section,
learn how to customize each stage of your app's initialization.

在本節中，
瞭解如何自訂應用程式初始化的各個階段。

### Loading the entrypoint

### 載入入口

The `loadEntrypoint` method accepts these parameters:

`loadEntrypoint` 方法接受以下引數：

<div class="table-wrapper" markdown="1">

| <t>Name</t><t>引數名稱</t> | <t>Description</t><t>描述</t> | <t>JS&nbsp;Type</t><t>JS&nbsp;型別</t> |
|-|-|-|
|`entrypointUrl`| The URL of your Flutter app's entrypoint. Defaults to `"main.dart.js"`. |`String`|
|`entrypointUrl`| Flutter 應用程式入口的 URL。預設為 `"main.dart.js"`。 |`String`|
|`onEntrypointLoaded`| The function called when the engine is ready to be initialized. Receives an `engineInitializer` object as its only parameter. |`Function`|
|`onEntrypointLoaded`| 當引擎準備初始化時呼叫的函式。該函式的唯一引數是一個 `engineInitializer` 物件。  |`Function`|
|`serviceWorker`| The configuration for the `flutter_service_worker.js` loader. (If not set, the service worker won't be used.) |`Object`|
|`serviceWorker`| `flutter_service_worker.js` 載入器的配置。（如果未設定，則不會使用 service worker）。 |`Object`|
{:.table}

</div>

The `serviceWorker` JavaScript object accepts the following properties:

`serviceWorker` JavaScript 物件接受以下屬性：

<div class="table-wrapper" markdown="1">

| <t>Name</t><t>屬性名稱</t> | <t>Description</t><t>描述</t> | <t>JS&nbsp;Type</t><t>JS&nbsp;型別</t> |
|-|-|-|
|`serviceWorkerUrl`| The URL of the Service Worker JS file. The `serviceWorkerVersion` is appended to the URL. Defaults to `"flutter_service_worker.js?v="` |`String`|
|`serviceWorkerUrl`| Service Worker JS 檔案的 URL。`serviceWorkerVersion` 會附加到 URL 中。預設為 `"flutter_service_worker.js?v="`。 |`String`|
|`serviceWorkerVersion`| Pass *the `serviceWorkerVersion` variable* set by the build process in your **`index.html`** file. |`String`|
|`serviceWorkerVersion`| 建構過程會賦值 *`serviceWorkerVersion` 變數* 並在 **`index.html`** 中運用。 |`String`|
|`timeoutMillis`| The timeout value for the service worker load. Defaults to `4000`. |`Number`|
|`timeoutMillis`| service worker 負載的超時時間（毫秒）。預設為 `4000`。 |`Number`|
{:.table}

</div>

### Initializing the engine

### 初始化引擎

As of _Flutter 3.7.0_, you can use the `initializeEngine` method to
configure several run-time options of the Flutter web engine through a
plain JavaScript object.

從 `Flutter 3.7.0 版本` 起，
你可以使用 `initializeEngine` 方法透過純 JavaScript 物件
配置 Flutter web 引擎的多個執行時選項。

You can add any of the following optional parameters:

你可以新增以下任何可選引數：

<div class="table-wrapper" markdown="1">

| <t>Name</t><t>引數名稱</t> | <t>Description</t><t>描述</t> | <t>Dart&nbsp;Type</t><t>Dart&nbsp;型別</t> |
|-|-|-|
|`assetBase`| The base URL of the `assets` directory of the app. Add this when Flutter loads from a different domain or subdirectory than the actual web app. You might need this when you embed Flutter web into another app, or when you deploy its assets to a CDN. |`String`|
|`assetBase`| 應用程式 `assets` 目錄的根 URL。當 Flutter 從實際 web 應用不同的域或子目錄載入時，請新增此 URL。當你將 Flutter web 嵌入另一個應用程式，或將其靜態資源部署到 CDN 時，可能需要使用此 URL。 |`String`|
|`canvasKitBaseUrl`| The base URL from where `canvaskit.wasm` is downloaded. |`String`|
|`canvasKitBaseUrl`| 下載 `canvaskit.wasm` 的根 URL。 |`String`|
|`canvasKitVariant`| The CanvasKit variant to download. Your options cover:<br><br>1. `auto`: Downloads the optimal variant for the browser. The option defaults to this value.<br>2. `full`: Downloads the full variant of CanvasKit that works in all browsers.<br>3. `chromium`: Downloads a smaller variant of CanvasKit that uses Chromium compatible APIs. **_Warning_**: Don't use the `chromium` option unless you plan on only using Chromium-based browsers. |`String`|
|`canvasKitVariant`| 下載 CanvasKit。你的可選值：<br><br>1. `auto`：為瀏覽器下載最佳版本。（預設值）<br>2. `full`：下載適用於所有瀏覽器的 CanvasKit 完整版。<br>3. `chromium`：下載較小的 CanvasKit，該版本使用與 Chromium 相容的 API。**_警告_**：除非你只打算使用基於 Chromium 的瀏覽器，否則不要使用 `chromium` 值。 |`String`|
|`canvasKitForceCpuOnly`| When `true`, forces CPU-only rendering in CanvasKit (the engine won't use WebGL). |`bool`|
|`canvasKitForceCpuOnly`| 為 `true` 時，強制在 CanvasKit 中只使用 CPU 進行渲染（引擎不會使用 WebGL）。 |`bool`|
|`canvasKitMaximumSurfaces`| The maximum number of overlay surfaces that the CanvasKit renderer can use. |`double`|
|`canvasKitMaximumSurfaces`| CanvasKit 渲染器可使用的最大覆蓋層數。 |`double`|
|`debugShowSemanticNodes`| If `true`, Flutter visibly renders the semantics tree onscreen (for debugging).  |`bool`|
|`debugShowSemanticNodes`| 如果為 `true`，Flutter 會在螢幕上明顯呈現 semantics 語義樹（用於除錯）。 |`bool`|
|`hostElement`| HTML Element into which Flutter renders the app. When not set, Flutter web takes over the whole page. |`HtmlElement`|
|`hostElement`| 用於 Flutter 渲染應用程式的 HTML 元素。未設定時，Flutter web 會佔據整個頁面。 |`HtmlElement`|
|`renderer`| Specifies the [web renderer][web-renderers] for the current Flutter application, either `"canvaskit"` or `"html"`. |`String`|
|`renderer`| 指定當前 Flutter 應用程式的 [web 渲染器][web-renderers]，可選 `"canvaskit"` 或 `"html"`。 |`String`|
{:.table}

</div>

[jsflutterconfig-source]: {{site.github}}/flutter/engine/blob/main/lib/web_ui/lib/src/engine/configuration.dart#L247-L259
[web-renderers]: {{site.url}}/platform-integration/web/renderers

{{site.alert.note}}

  Some of the parameters described above might have been overridden
  in previous releases by using properties in the `window` object.
  That approach is still supported, but displays a **deprecation
  notice** in the JS console, as of **Flutter 3.7.0**.

  在以前的版本中，上述某些引數可能是透過使用 `window` 物件中的屬性來覆蓋的。
  從 **Flutter 3.7.0 版本** 起，這種方式仍然支援，
  但會在 JS 控制檯中顯示 **棄用通知**。

{{site.alert.end}}

#### Engine configuration example

#### 引擎配置範例

The `initializeEngine` method lets you pass any of the configuration
parameters described above to your Flutter app.

透過 `initializeEngine` 方法，
你可以向 Flutter 應用程式傳遞上述任何配置引數。

Consider the following example.

請看下面這個例子。

Your Flutter app should target an HTML element with `id="flutter_app"` and
use the `canvaskit` renderer. The resulting JavaScript code would resemble
the following:

你的 Flutter 應用程式使用 `id="flutter_app"` 的 HTML 元素，
並使用 `canvaskit` 渲染器。
JavaScript 程式碼就像下面這樣：

```js
onEntrypointLoaded: async function(engineInitializer) {
  let appRunner = await engineInitializer.initializeEngine({
    hostElement: document.querySelector("#flutter_app"),
    renderer: "canvaskit"
  });
  appRunner.runApp();
}
```

For a more detailed explanation of each parameter, take a look at the
**"Runtime parameters"** documentation section of the [`configuration.dart`][config-dart]
file of the web engine.

有關每個引數的詳細解釋，
請查閱 web 引擎 [`configuration.dart`][config-dart] 檔案中，
文件的 **"Runtime parameters"** 部分。

[config-dart]: {{site.github}}/flutter/engine/blob/main/lib/web_ui/lib/src/engine/configuration.dart#L174

#### Skipping this step

#### 跳過此步驟

Instead of calling `initializeEngine()` on the engine initializer (and then
`runApp()` on the application runner), you can call `autoStart()` to
initialize the engine with its default configuration, and then start the app
immediately after the initialization is complete:

與其在 engine initializer 上呼叫 `initializeEngine()` 
（然後在 app runner 上呼叫 `runApp()`），
不如呼叫 `autoStart()` 以預設配置初始化引擎，
然後在初始化完成後立即啟動應用程式。

```js
_flutter.loader.loadEntrypoint({
  serviceWorker: {
    serviceWorkerVersion: serviceWorkerVersion,
  },
  onEntrypointLoaded: async function(engineInitializer) {
    await engineInitializer.autoStart();
  }
});
```

## Example: Display a progress indicator

## 範例：顯示進度指示器

To give the user of your application feedback
during the initialization process,
use the hooks provided for each stage to update the DOM:

為了在應用程式初始化過程中向用戶提供反饋，
請使用各個階段提供的鉤子來更新 DOM：

```html
<html>
  <head>
    <!-- ... -->
    <script src="flutter.js" defer></script>
  </head>
  <body>
    <div id="loading"></div>
    <script>
      window.addEventListener('load', function(ev) {
        var loading = document.querySelector('#loading');
        loading.textContent = "Loading entrypoint...";
        _flutter.loader.loadEntrypoint({
          serviceWorker: {
            serviceWorkerVersion: serviceWorkerVersion,
          },
          onEntrypointLoaded: async function(engineInitializer) {
            loading.textContent = "Initializing engine...";
            let appRunner = await engineInitializer.initializeEngine();

            loading.textContent = "Running app...";
            await appRunner.runApp();
          }
        });
      });
    </script>
  </body>
</html>
```

For a more practical example using CSS animations,
see the [initialization code][gallery-init] for the Flutter Gallery.

更多關於實用的 CSS 動畫範例，
請查閱 Flutter Gallery 的 [初始化程式碼][gallery-init]。

[gallery-init]: {{site.github}}/flutter/gallery/blob/master/web/index.html

## Upgrading an older project

## 升級舊專案

If your project was created in Flutter 2.10 or earlier,
you can create a new `index.html` file
with the latest initialization template by running
`flutter create` as follows.

如果你的專案是在 Flutter 2.10 或更早版本中建立的，
你可以透過執行 `flutter create` 指令
建立一個帶有最新初始化範本的 `index.html` 檔案，
方法如下。

First, remove the files from your `/web` directory.

首先，刪除 `/web` 目錄中的檔案。

Then, from your project directory, run the following:

然後，在專案目錄下執行以下指令：

```
$ flutter create . --platforms=web
```
